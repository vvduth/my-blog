{% include "header.html" %}

<!-- Cyberpunk Hero Section -->
<div class="hero-cyber">
    <canvas id="matrix-rain"></canvas>
    <div class="hero-content">
        <div class="container px-4 px-lg-5">
            <div class="row justify-content-center">
                <div class="col-lg-8 text-center">
                    <h1 class="cyber-glitch-text hero-title" data-text="CYBERBLOG.SYS">
                        CYBERBLOG.SYS
                    </h1>
                    <div class="terminal-text hero-subtitle mt-4">
                        <p class="mb-2"><span class="text-cyber-cyan">></span> INITIALIZING_NEURAL_NETWORK...</p>
                        <p class="mb-2"><span class="text-cyber-pink">></span> LOADING_CONSCIOUSNESS_STREAM...</p>
                        <p class="typing-effect"><span class="text-cyber-green">></span> SHARE_YOUR_DIGITAL_SOUL</p>
                    </div>
                    {% if current_user.id in [1, 2] %}
                    <div class="mt-4">
                        <a href="{{ url_for('add_new_post') }}" class="btn-cyber btn-cyber-lg">
                            <span class="cyber-bracket">[</span>NEW_POST<span class="cyber-bracket">]</span>
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cyberpunk Blog Grid -->
<div class="container px-4 px-lg-5 py-5">
    <!-- Tag Filter Section -->
    <div class="mb-4">
        <!-- Desktop View: Tag Buttons -->
        <div class="d-none d-md-block">
            <div class="card-cyber p-3">
                <div class="terminal-text mb-3">
                    <span class="text-cyber-cyan">FILTER_BY_TAG:</span>
                </div>
                <div class="d-flex flex-wrap gap-2">
                    <a href="{{ url_for('get_all_posts') }}" 
                       class="btn-cyber btn-cyber-sm {% if not filtered_tag %}btn-cyber-active{% endif %}">
                        <span class="cyber-bracket">[</span>ALL<span class="cyber-bracket">]</span>
                    </a>
                    {% for tag in predefined_tags %}
                    <a href="{{ url_for('filter_by_tag', tag_name=tag) }}" 
                       class="btn-cyber btn-cyber-sm {% if filtered_tag == tag %}btn-cyber-active{% endif %}">
                        <span class="cyber-bracket">[</span>{{ tag }}<span class="cyber-bracket">]</span>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- Mobile View: Dropdown -->
        <div class="d-md-none">
            <div class="card-cyber p-3">
                <div class="terminal-text mb-2">
                    <span class="text-cyber-cyan">FILTER:</span>
                </div>
                <select class="form-control-cyber" onchange="if(this.value) window.location.href=this.value;">
                    <option value="{{ url_for('get_all_posts') }}" {% if not filtered_tag %}selected{% endif %}>ALL POSTS</option>
                    {% for tag in predefined_tags %}
                    <option value="{{ url_for('filter_by_tag', tag_name=tag) }}" {% if filtered_tag == tag %}selected{% endif %}>#{{ tag }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>
    
    {% if filtered_tag %}
    <!-- Filter Indicator -->
    <div class="alert alert-cyber mb-4" style="background: rgba(0, 255, 255, 0.1); border: 1px solid var(--cyber-cyan); border-radius: 8px;">
        <div class="terminal-text">
            <p class="mb-0">
                <span class="text-cyber-cyan">FILTER_ACTIVE:</span> 
                Showing posts tagged with 
                <span class="badge bg-cyber-pink" style="font-size: 0.9rem; padding: 0.3rem 0.6rem;">#{{ filtered_tag }}</span>
                <a href="{{ url_for('get_all_posts') }}" class="btn-cyber btn-cyber-sm ms-3">
                    <span class="cyber-bracket">[</span>CLEAR_FILTER<span class="cyber-bracket">]</span>
                </a>
            </p>
        </div>
    </div>
    {% endif %}
    
    {% if all_posts %}
    <!-- 2x2 Grid Layout for Posts -->
    <div class="row g-4 mb-5">
        {% for post in all_posts %}
        <div class="col-md-6">
            <article class="card-cyber h-100">
                <div class="card-cyber-header">
                    <div class="terminal-text mb-2">
                        <span class="text-cyber-cyan">FILE:</span> POST_{{ "%04d"|format(post.id) }}.SYS
                    </div>
                    <h3 class="card-cyber-title">
                        <a href="{{ url_for('show_post', post_id=post.id) }}" class="cyber-link-title">
                            {{ post.title }}
                        </a>
                    </h3>
                    <p class="card-cyber-subtitle">{{ post.subtitle }}</p>
                </div>
                
                <div class="card-cyber-body">
                    <div class="terminal-text small">
                        <p class="mb-1">
                            <span class="text-cyber-green">DATE:</span> {{ post.date }}
                        </p>
<!--                        <p class="mb-1">-->
<!--                            <span class="text-cyber-pink">AUTHOR:</span> {{ post.author.name }}-->
<!--                        </p>-->
<!--                        <p class="mb-1">-->
<!--                            <span class="text-cyber-green">DATE:</span> {{ post.date }}-->
<!--                        </p>

                        {% if post.tags %}
                        <p class="mb-2">
                            <span class="text-cyber-cyan">TOPICS:</span>
                            {% for tag in post.tags %}
                            <a href="{{ url_for('filter_by_tag', tag_name=tag) }}" 
                               class="badge bg-cyber-pink me-1 text-decoration-none"
                               style="font-size: 0.7rem; padding: 0.25rem 0.5rem;">
                                #{{ tag }}
                            </a>
                            {% endfor %}
                        </p>
                        {% endif %}
<!--                        {% if post.body %}-->
<!--                        <p class="mt-3 text-muted">-->
<!--                            {{ post.body[:150]|striptags }}{% if post.body|length > 150 %}...{% endif %}-->
<!--                        </p>-->
<!--                        {% endif %}-->
                    </div>
                </div>
                
                <div class="card-cyber-footer">
                    <a href="{{ url_for('show_post', post_id=post.id) }}" class="btn-cyber btn-cyber-sm">
                        <span class="cyber-bracket">[</span>READ_MORE<span class="cyber-bracket">]</span>
                    </a>
                    
                    {% if current_user.id in [1, 2] %}
                    <div class="admin-actions">
                        <a href="{{ url_for('edit_post', post_id=post.id) }}" 
                           class="btn-cyber btn-cyber-sm btn-cyber-outline"
                           title="Edit">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{{ url_for('delete_post', post_id=post.id) }}" 
                           class="btn-cyber btn-cyber-sm btn-cyber-danger"
                           onclick="return confirm('DELETE THIS POST FROM THE SYSTEM?')"
                           title="Delete">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                    {% endif %}
                </div>
            </article>
        </div>
        {% endfor %}
    </div>
    
    {% else %}
    <!-- No Posts Terminal Message -->
    <div class="card-cyber text-center py-5">
        <div class="terminal-text">
            <p class="mb-3"><span class="text-cyber-pink">ERROR:</span> NO_DATA_FOUND</p>
            <p class="cyber-glitch-text" data-text="SYSTEM AWAITING INPUT">SYSTEM AWAITING INPUT</p>
            <p class="mt-4 mb-4">
                <span class="text-cyber-cyan">></span> BE THE FIRST TO UPLOAD YOUR CONSCIOUSNESS
            </p>
            {% if current_user.id in [1, 2] %}
            <a href="{{ url_for('add_new_post') }}" class="btn-cyber">
                <span class="cyber-bracket">[</span>INITIALIZE_FIRST_POST<span class="cyber-bracket">]</span>
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Cyberpunk Pagination -->
    {% if total_pages > 1 %}
    <nav aria-label="Blog pagination" class="mt-5">
        <div class="pagination-cyber">
            {% if page_index > 1 %}
            <a href="{{ url_for('filter_by_tag' if filtered_tag else 'get_all_posts', tag_name=filtered_tag, page_index=page_index - 1) if filtered_tag else url_for('get_all_posts', page_index=page_index - 1) }}" class="pagination-btn">
                <span class="cyber-bracket">[</span><i class="fas fa-chevron-left"></i> PREV<span class="cyber-bracket">]</span>
            </a>
            {% endif %}
            
            <div class="pagination-pages">
                {% for page_num in range(1, total_pages + 1) %}
                  {% if page_num == page_index %}
                    <span class="pagination-page active">
                        <span class="cyber-bracket">[</span>{{ page_num }}<span class="cyber-bracket">]</span>
                    </span>
                  {% elif page_num <= page_index + 2 and page_num >= page_index - 2 %}
                    <a href="{{ url_for('filter_by_tag' if filtered_tag else 'get_all_posts', tag_name=filtered_tag, page_index=page_num) if filtered_tag else url_for('get_all_posts', page_index=page_num) }}" class="pagination-page">
                        {{ page_num }}
                    </a>
                  {% elif page_num == 1 or page_num == total_pages %}
                    <a href="{{ url_for('filter_by_tag' if filtered_tag else 'get_all_posts', tag_name=filtered_tag, page_index=page_num) if filtered_tag else url_for('get_all_posts', page_index=page_num) }}" class="pagination-page">
                        {{ page_num }}
                    </a>
                  {% elif page_num == page_index - 3 or page_num == page_index + 3 %}
                    <span class="pagination-ellipsis">...</span>
                  {% endif %}
                {% endfor %}
            </div>
            
            {% if page_index < total_pages %}
            <a href="{{ url_for('filter_by_tag' if filtered_tag else 'get_all_posts', tag_name=filtered_tag, page_index=page_index + 1) if filtered_tag else url_for('get_all_posts', page_index=page_index + 1) }}" class="pagination-btn">
                <span class="cyber-bracket">[</span>NEXT <i class="fas fa-chevron-right"></i><span class="cyber-bracket">]</span>
            </a>
            {% endif %}
        </div>
    </nav>
    {% endif %}
</div>

{% include "footer.html" %}
